# 🎰 Сугалааны систем - Хэрэглэгчийн заавар

## 📋 Ерөнхий тойм

Энэхүү систем нь Excel файлаас банкны гүйлгээг импортолж, автоматаар сугалаа үүсгэдэг.

---

## 🚀 Алхам алхмаар заавар

### 1️⃣ Машин сонгох

1. `/admin` хуудас руу очино
2. Машины жагсаалтаас нэг машин сонгоно
3. **"Excel импорт хийх"** товч дарна
4. → `/add?carId=X` хуудас руу шилжинэ

---

### 2️⃣ Excel файл оруулах

#### Шаардлагатай зүйлс:
- ✅ **Ажилтны нэр** (заавал!)
- ✅ Excel файл (.xlsx, .xls)
- ✅ 9-р мөрнөөс өгөгдөл эхлэх ёстой

#### Алхмууд:
1. **Ажилтны нэрээ оруулах** (жишээ: "Бат", "Болд")
2. Excel файл чирэх эсвэл дарж сонгох
3. Систем автоматаар:
   - Гүйлгээнүүдийг уншина
   - Хэдэн сугалаа үүсэх вэ тооцоолно
   - Урьдчилсан мэдээлэл харуулна

---

### 3️⃣ Сугалааны preview шалгах

Excel import хийсний дараа дараах мэдээллийг харна:

```
┌─────────────────────────────────────────┐
│  📊 Нийт гүйлгээ:         50            │
│  ✅ Үүсэх сугалаа:        120           │
│  ⚠️  Алгасагдах гүйлгээ:   5            │
└─────────────────────────────────────────┘
```

#### Сугалааны үнэ өөрчлөх

Та **"Нэг сугалааны үнэ"** input дээр үнийг өөрчилж болно:
- Default: 20,000₮
- Үнийг өөрчлөхөд сугалааны тоо **автоматаар** дахин тооцогдоно

**Жишээ:**
- 20,000₮ → 120 сугалаа
- 50,000₮ → 48 сугалаа
- 10,000₮ → 240 сугалаа

---

### 4️⃣ Database-д хадгалах

1. **"Датабазд хадгалах"** товч дарна
2. Гүйлгээнүүд `bankTransactions` table-д хадгалагдана
3. ✅ Амжилттай message харагдана

---

### 5️⃣ Сугалаа үүсгэх

Гүйлгээнүүдийг хадгалсны дараа:

1. **"Сугалаа үүсгэх"** хэсэг доор:
   - Үүссэн сугалаа: 0
   - Боловсруулаагүй гүйлгээ: 50
2. **"Сугалаа үүсгэх"** товч дарна
3. Ticket price асуух popup гарна (default: 20000)
4. ✅ Сугалаанууд үүсэж, статистик шинэчлэгдэнэ

```
Үр дүн:
✅ 120 сугалаа үүслээ!
• Боловсруулсан гүйлгээ: 45
• Алгасагдсан: 5
```

---

## 📊 Сугалаа тооцоолох томьёо

### QPAY шимтгэл тооцоолох

```
Gross Amount = floor(Net Amount / 0.98)
Ticket Count = floor(Gross Amount / Ticket Price)
```

**0.98** = 1 - 0.01 (QPAY) - 0.01 (tolerance)

### Жишээнүүд

| Гүйлгээний дүн | Ticket Price | Gross | Сугалаа |
|---------------|-------------|-------|--------|
| 19,600₮ | 20,000₮ | 20,000₮ | **1** |
| 49,000₮ | 20,000₮ | 50,000₮ | **2** |
| 98,000₮ | 20,000₮ | 100,000₮ | **5** |
| 15,000₮ | 20,000₮ | 15,306₮ | **0** ⚠️ |

⚠️ **Алгасагдсан:** Хэтэрхий бага дүнтэй гүйлгээ

---

## 🔄 Workflow diagram

```
┌─────────────────┐
│  1. Машин       │
│     сонгох      │
└────────┬────────┘
         │
         v
┌─────────────────┐
│  2. Excel       │
│     оруулах     │
└────────┬────────┘
         │
         v
┌─────────────────┐
│  3. Preview     │
│     харах       │   ← Ticket price өөрчлөх
└────────┬────────┘
         │
         v
┌─────────────────┐
│  4. Database-д  │
│     хадгалах    │
└────────┬────────┘
         │
         v
┌─────────────────┐
│  5. Сугалаа     │
│     үүсгэх      │
└─────────────────┘
```

---

## ⚡ Давуу талууд

### 1. Автоматаар тооцоолох
- ✅ Excel файл уншаад шууд preview харуулна
- ✅ Ticket price өөрчлөхөд real-time шинэчлэгдэнэ
- ✅ Алгасагдах гүйлгээг автоматаар тодорхойлно

### 2. Давхардахгүй
- ✅ Нэг гүйлгээнд **ганц удаа** сугалаа үүснэ
- ✅ Дахин "Сугалаа үүсгэх" дарвал зөвхөн шинэ гүйлгээ боловсруулна

### 3. Хэрэглэгчид ээлтэй
- ✅ Гүйлгээний жагсаалт устсан (ямар ч хэрэггүй)
- ✅ Зөвхөн чухал мэдээлэл харуулна:
  - Хэдэн гүйлгээ импортолсон?
  - Хэдэн сугалаа үүсэх вэ?
  - Хэдэн гүйлгээ алгасагдах вэ?

---

## 🎯 Нийтлэг асуултууд (FAQ)

### Q1: Яагаад зарим гүйлгээ алгасагдаж байна вэ?

**A:** Гүйлгээний дүн хэтэрхий бага байна.

**Жишээ:**
- Ticket price: 20,000₮
- Гүйлгээ: 15,000₮
- Gross: 15,306₮ → **0 сугалаа** ❌

**Шийдэл:** Ticket price-г бууруулах (жишээ: 10,000₮)

---

### Q2: Ticket price-г яаж сонгох вэ?

**A:** Машины үнэ болон хэдэн сугалаа үүсгэхийг хүсч байгаагаас хамаарна.

**Жишээ 1:** Машин 10,000,000₮
- Ticket price: 20,000₮ → 500 сугалаа хэрэгтэй
- Total орлого: 500 × 20,000 = 10,000,000₮

**Жишээ 2:** Машин 5,000,000₮
- Ticket price: 10,000₮ → 500 сугалаа хэрэгтэй
- Total орлого: 500 × 10,000 = 5,000,000₮

---

### Q3: Сугалаа дахин үүсгэж болох уу?

**A:** ✅ Тийм, гэхдээ давхардахгүй.

- 1-р удаа: 50 гүйлгээ → 120 сугалаа
- 2-р удаа: 0 гүйлгээ (бүгд боловсруулагдсан)
- Шинэ Excel импортолсон бол шинэ гүйлгээнүүд үүснэ

---

### Q4: Ажилтны нэр яагаад шаардлагатай вэ?

**A:** Хэн Excel импортолсоныг мэдэхийн тулд. Database-д хадгалагдана.

```sql
SELECT * FROM bankTransactions WHERE employeeName = 'Бат';
```

---

### Q5: Maximum хэдэн сугалаа үүсч болох вэ?

**A:** Нэг гүйлгээнд **maximum 5000 сугалаа**.

**Жишээ:**
- Гүйлгээ: 100,000,000₮
- Ticket price: 10,000₮
- → 5000 сугалаа (cap limit)

---

## 🛠️ Troubleshooting

### Асуудал 1: Preview харагдахгүй байна

**Шалгах:**
- ✅ Excel файл import хийсэн эсэх
- ✅ Гүйлгээ олдсон эсэх (9-р мөрнөөс эхлэх)
- ✅ Browser console шалгах (F12)

---

### Асуудал 2: Сугалаа үүсэхгүй байна

**Шалгах:**
1. Database-д хадгалсан эсэх
2. "Боловсруулаагүй гүйлгээ" > 0 эсэх
3. Ticket price буруу биш эсэх

---

### Асуудал 3: Бүх гүйлгээ алгасагдаж байна

**Шалтгаан:** Ticket price хэтэрхий өндөр байна.

**Шийдэл:**
1. Ticket price-г бууруулах
2. Preview дахин шалгах
3. Сугалааны тоо > 0 болох хүртэл

---

## 📞 Тусламж

Асуудал гарвал:
1. Browser console (F12) шалгах
2. Network tab шалгах
3. Backend logs шалгах

---

**Амжилт хүсье! 🎉🚗**
